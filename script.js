// Data katalog default
const defaultKatalog = [
    {
        id: 1,
        nama: "Bao Trum 9",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah muda cerah dan bentuk yang indah.",
        gambar: "Asset/Bao Trum 9.jpeg"
    },
    {
        id: 2,
        nama: "Black Canyon",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah tua hingga hampir hitam, sangat unik dan menarik.",
        gambar: "Asset/Black Canyon.jpeg"
    },
    {
        id: 3,
        nama: "Cecilia",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna pink lembut dengan corak putih di bagian tengah.",
        gambar: "Asset/Cecilia.jpeg"
    },
    {
        id: 4,
        nama: "Dragon Castle",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah terang dengan bentuk yang menyerupai kastil.",
        gambar: "Asset/Dragon Castle.jpeg"
    },
    {
        id: 5,
        nama: "Dunhuang",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah muda dengan corak putih yang indah.",
        gambar: "Asset/Dunhuang.jpeg"
    },
    {
        id: 6,
        nama: "HasadePink",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna pink cerah dan bentuk yang cantik.",
        gambar: "Asset/HasadePink.jpeg"
    },
    {
        id: 7,
        nama: "Beauty Varigata",
        jenis: "koleksi",
        deskripsi: "Adenium koleksi dengan daun variegata dan bunga berwarna merah muda yang sangat indah.",
        gambar: "Asset/Beauty Varigata Koleksi.jpeg"
    },
    {
        id: 8,
        nama: "Moonlight Yellow",
        jenis: "koleksi",
        deskripsi: "Adenium koleksi dengan bunga berwarna kuning cerah yang sangat langka dan menarik.",
        gambar: "Asset/Moonlight Yellow Koleksian.jpeg"
    },
    {
        id: 9,
        nama: "Percabangan Aktif",
        jenis: "koleksi",
        deskripsi: "Adenium koleksi dengan percabangan yang aktif dan banyak, sangat cocok untuk bonsai.",
        gambar: "Asset/Percabangan Aktif Koleksi.jpeg"
    },
    {
        id: 10,
        nama: "Petit",
        jenis: "koleksi",
        deskripsi: "Adenium koleksi dengan ukuran mini yang sangat menggemaskan dan bunga yang indah.",
        gambar: "Asset/Petit Koleksi.jpeg"
    },
    {
        id: 11,
        nama: "Thaisoco",
        jenis: "koleksi",
        deskripsi: "Adenium koleksi dari Thailand dengan bentuk dan warna bunga yang sangat eksotis.",
        gambar: "Asset/Thaisoco Koleksi.jpeg"
    },
    {
        id: 12,
        nama: "Honey Lemon",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna kuning lemon yang segar dan cerah.",
        gambar: "Asset/Honey Lemon.jpeg"
    },
    {
        id: 13,
        nama: "Hot Girl",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah menyala yang sangat mencolok.",
        gambar: "Asset/Hot Girl.jpeg"
    },
    {
        id: 14,
        nama: "Ijo Celontong",
        jenis: "biasa",
        deskripsi: "Adenium dengan daun hijau gelap dan bunga yang cantik.",
        gambar: "Asset/Ijo Celontong.jpeg"
    },
    {
        id: 15,
        nama: "Jaws",
        jenis: "biasa",
        deskripsi: "Adenium dengan bentuk bunga yang unik menyerupai rahang.",
        gambar: "Asset/Jaws.jpeg"
    },
    {
        id: 16,
        nama: "Julius Caesar",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah keunguan yang sangat megah.",
        gambar: "Asset/Julius Caesar.jpeg"
    },
    {
        id: 17,
        nama: "Legend",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah cerah dan bentuk yang legendaris.",
        gambar: "Asset/Legend.jpeg"
    },
    {
        id: 18,
        nama: "Liberty",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah putih yang melambangkan kebebasan.",
        gambar: "Asset/Liberty.jpeg"
    },
    {
        id: 19,
        nama: "Lotus Evija",
        jenis: "biasa",
        deskripsi: "Adenium dengan bentuk bunga yang menyerupai bunga lotus, sangat eksotis.",
        gambar: "Asset/Lotus Evija.jpeg"
    },
    {
        id: 20,
        nama: "MO",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah orange yang cerah dan menarik.",
        gambar: "Asset/MO.jpeg"
    },
    {
        id: 21,
        nama: "Mongcam",
        jenis: "biasa",
        deskripsi: "Adenium dengan bentuk yang unik dan warna bunga yang menawan.",
        gambar: "Asset/Mongcam.jpeg"
    },
    {
        id: 22,
        nama: "Musk Lady",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna pink lembut yang sangat anggun.",
        gambar: "Asset/Musk Lady.jpeg"
    },
    {
        id: 23,
        nama: "Orange JE",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna orange cerah yang sangat menarik perhatian.",
        gambar: "Asset/Orange JE.jpeg"
    },
    {
        id: 24,
        nama: "PetMongkon",
        jenis: "biasa",
        deskripsi: "Adenium dengan bentuk yang unik dan percabangan yang indah.",
        gambar: "Asset/PetMongkon.jpeg"
    },
    {
        id: 25,
        nama: "Purpel Jinda",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna ungu yang sangat langka dan eksotis.",
        gambar: "Asset/Purpel Jinda.jpeg"
    },
    {
        id: 27,
        nama: "Racan Purpel",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna ungu kemerahan yang sangat menawan.",
        gambar: "Asset/Racan Purpel.jpeg"
    },
    {
        id: 28,
        nama: "Santa Clause",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna merah cerah yang mengingatkan pada Santa Claus.",
        gambar: "Asset/Santa Clause.jpeg"
    },
    {
        id: 29,
        nama: "Snow White",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna putih bersih seperti salju yang sangat cantik.",
        gambar: "Asset/Snow White.jpeg"
    },
    {
        id: 30,
        nama: "Sunny Day",
        jenis: "biasa",
        deskripsi: "Adenium dengan bunga berwarna kuning cerah yang mengingatkan pada hari yang cerah.",
        gambar: "Asset/Sunny Day.jpeg"
    },
    {
        id: 31,
        nama: "Taurus",
        jenis: "biasa",
        deskripsi: "Adenium dengan bentuk yang kokoh dan bunga berwarna merah yang kuat seperti Taurus.",
        gambar: "Asset/Taurus.jpeg"
    },
    {
        id: 32,
        nama: "Trung Thing",
        jenis: "biasa",
        deskripsi: "Adenium dari Vietnam dengan bentuk dan warna bunga yang sangat eksotis.",
        gambar: "Asset/Trung Thing.jpeg"
    }
];

// DOM Elements
const slider = document.querySelector('.slider');
const slides = document.querySelectorAll('.slide');
const prevBtn = document.querySelector('.prev-btn');
const nextBtn = document.querySelector('.next-btn');
const dotsContainer = document.querySelector('.slider-dots');
const katalogContainer = document.getElementById('katalog-container');
const filterBtns = document.querySelectorAll('.filter-btn');
const searchInput = document.getElementById('search-input');
const searchBtn = document.getElementById('search-btn');
const tambahItemBtn = document.getElementById('tambah-item-btn');
const tambahKatalogForm = document.getElementById('tambah-katalog-form');
const tambahForm = document.getElementById('tambah-form');
const contactForm = document.getElementById('contact-form');
const hamburger = document.querySelector('.hamburger');
const menu = document.querySelector('.menu');

// Initialize the application
// Modal functionality
function openImageModal(imageSrc, caption) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    const modalCaption = document.getElementById('modalCaption');
    
    modal.style.display = 'block';
    modalImg.src = imageSrc;
    modalCaption.innerHTML = caption;
    
    // Close modal when clicking on X
    const closeBtn = document.getElementsByClassName('close')[0];
    closeBtn.onclick = function() {
        modal.style.display = 'none';
    }
    
    // Close modal when clicking outside the image
    modal.onclick = function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    // Initialize slider
    initSlider();
    
    // Initialize katalog
    initKatalog();
    
    // Initialize event listeners
    initEventListeners();
});

// Slider functionality
function initSlider() {
    // Create dots for each slide
    slides.forEach((_, index) => {
        const dot = document.createElement('div');
        dot.classList.add('dot');
        if (index === 0) dot.classList.add('active');
        dot.addEventListener('click', () => goToSlide(index));
        dotsContainer.appendChild(dot);
    });
    
    // Set up automatic slider
    let currentSlide = 0;
    const dots = document.querySelectorAll('.dot');
    
    function goToSlide(index) {
        slides.forEach(slide => slide.classList.remove('active'));
        dots.forEach(dot => dot.classList.remove('active'));
        
        slides[index].classList.add('active');
        dots[index].classList.add('active');
        currentSlide = index;
    }
    
    function nextSlide() {
        currentSlide = (currentSlide + 1) % slides.length;
        goToSlide(currentSlide);
    }
    
    function prevSlide() {
        currentSlide = (currentSlide - 1 + slides.length) % slides.length;
        goToSlide(currentSlide);
    }
    
    // Set up event listeners for slider controls
    nextBtn.addEventListener('click', nextSlide);
    prevBtn.addEventListener('click', prevSlide);
    
    // Auto slide every 5 seconds
    setInterval(nextSlide, 5000);
}

// Katalog functionality
function initKatalog() {
    // Load katalog from localStorage or use default
    let katalog = JSON.parse(localStorage.getItem('katalog')) || defaultKatalog;
    
    // If katalog is empty or localStorage doesn't exist, use default
    if (katalog.length === 0 || !localStorage.getItem('katalog')) {
        katalog = defaultKatalog;
        localStorage.setItem('katalog', JSON.stringify(katalog));
    }
    
    // Display katalog items
    displayKatalog(katalog);
}

function displayKatalog(items) {
    katalogContainer.innerHTML = '';
    
    if (items.length === 0) {
        katalogContainer.innerHTML = '<p class="no-items">Tidak ada tanaman yang ditemukan.</p>';
        return;
    }
    
    items.forEach(item => {
        const katalogItem = document.createElement('div');
        katalogItem.classList.add('katalog-item');
        katalogItem.dataset.jenis = item.jenis;
        
        katalogItem.innerHTML = `
            <div class="katalog-image">
                <img src="${item.gambar}" alt="${item.nama}">
            </div>
            <div class="katalog-info">
                <h3>${item.nama}</h3>
                <span class="jenis ${item.jenis}">${item.jenis === 'koleksi' ? 'Adenium Koleksi' : 'Adenium Biasa'}</span>
                <p>${item.deskripsi}</p>
                <a href="https://wa.me/6285716942804?text=Halo,%20saya%20tertarik%20dengan%20${encodeURIComponent(item.nama)}%20yang%20dijual.%20Apakah%20masih%20tersedia?" class="btn" target="_blank">Pesan Sekarang</a>
            </div>
        `;
        
        katalogContainer.appendChild(katalogItem);
        
        // Tambahkan event listener untuk gambar
        const img = katalogItem.querySelector('.katalog-image img');
        img.addEventListener('click', function() {
            openImageModal(item.gambar, item.nama);
        });
    });
}

function filterKatalog(filter) {
    const katalog = JSON.parse(localStorage.getItem('katalog')) || defaultKatalog;
    let filteredItems;
    
    if (filter === 'all') {
        filteredItems = katalog;
    } else {
        filteredItems = katalog.filter(item => item.jenis === filter);
    }
    
    displayKatalog(filteredItems);
}

function searchKatalog(query) {
    const katalog = JSON.parse(localStorage.getItem('katalog')) || defaultKatalog;
    const searchQuery = query.toLowerCase().trim();
    
    if (searchQuery === '') {
        displayKatalog(katalog);
        return;
    }
    
    const filteredItems = katalog.filter(item => 
        item.nama.toLowerCase().includes(searchQuery) || 
        item.deskripsi.toLowerCase().includes(searchQuery)
    );
    
    displayKatalog(filteredItems);
}

function addKatalogItem(item) {
    const katalog = JSON.parse(localStorage.getItem('katalog')) || defaultKatalog;
    
    // Generate a new ID
    const newId = katalog.length > 0 ? Math.max(...katalog.map(item => item.id)) + 1 : 1;
    
    const newItem = {
        id: newId,
        nama: item.nama,
        jenis: item.jenis,
        deskripsi: item.deskripsi,
        gambar: item.gambar
    };
    
    katalog.push(newItem);
    localStorage.setItem('katalog', JSON.stringify(katalog));
    
    displayKatalog(katalog);
}

// Event listeners
function initEventListeners() {
    // Filter buttons
    filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            filterBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            filterKatalog(btn.dataset.filter);
        });
    });
    
    // Search functionality - improved with real-time search
    searchBtn.addEventListener('click', () => {
        searchKatalog(searchInput.value);
    });
    
    searchInput.addEventListener('keyup', () => {
        searchKatalog(searchInput.value);
    });
    
    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault(); // Prevent form submission
            searchKatalog(searchInput.value);
        }
    });
    
    // Toggle tambah katalog form
    tambahItemBtn.addEventListener('click', () => {
        if (tambahKatalogForm.style.display === 'none') {
            tambahKatalogForm.style.display = 'block';
            tambahItemBtn.textContent = '- Sembunyikan Form';
        } else {
            tambahKatalogForm.style.display = 'none';
            tambahItemBtn.textContent = '+ Tambah Item Katalog';
        }
    });
    
    // Add new katalog item
    tambahForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const newItem = {
            nama: document.getElementById('nama-tanaman').value,
            jenis: document.getElementById('jenis-tanaman').value,
            deskripsi: document.getElementById('deskripsi-tanaman').value,
            gambar: document.getElementById('gambar-tanaman').value
        };
        
        addKatalogItem(newItem);
        tambahForm.reset();
        
        // Hide form after adding item
        tambahKatalogForm.style.display = 'none';
        tambahItemBtn.textContent = '+ Tambah Item Katalog';
        
        alert('Tanaman berhasil ditambahkan ke katalog!');
    });
    
    // Contact form
    if (contactForm) {
        contactForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const nama = document.getElementById('nama').value;
            const email = document.getElementById('email').value;
            const telepon = document.getElementById('telepon').value;
            const pesan = document.getElementById('pesan').value;
            
            // Redirect to WhatsApp with the message
            const whatsappMessage = `Halo, saya ${nama}. Email: ${email}, Telepon: ${telepon}. Pesan: ${pesan}`;
            const whatsappUrl = `https://wa.me/6285716942804?text=${encodeURIComponent(whatsappMessage)}`;
            window.open(whatsappUrl, '_blank');
            
            contactForm.reset();
        });
    }
    
    // Mobile menu toggle
    hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        menu.classList.toggle('active');
    });
    
    // Close mobile menu when clicking on a menu item
    document.querySelectorAll('.menu a').forEach(link => {
        link.addEventListener('click', () => {
            hamburger.classList.remove('active');
            menu.classList.remove('active');
        });
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            if (targetElement) {
                window.scrollTo({
                    top: targetElement.offsetTop - 70, // Adjust for header height
                    behavior: 'smooth'
                });
            }
        });
    });
}